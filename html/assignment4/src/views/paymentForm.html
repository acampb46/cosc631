<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Payment</title>
</head>
<body>
<h2>Payment Form</h2>
<form id="payment-form">
    <div id="card-element">
        <!-- A Stripe Element will be inserted here. -->
    </div>
    <button id="submit">Pay</button>
</form>

<script>
    const stripe = Stripe('pk_live_51QMs0TLXTO62KelJ8rwplryV4kztBPbbNgWTKoy8rN1YVg4eb910IUP7TaSld6OMr3INnB7b0WDXRiCriYwKVthO00PKzeYhK1'); // Use public key here
    const elements = stripe.elements();
    const cardElement = elements.create('card');
    cardElement.mount('#card-element');

    const paymentForm = document.getElementById('payment-form');
    const submitButton = document.getElementById('submit');

    paymentForm.addEventListener('submit', async (event) => {
        event.preventDefault();

        // Create a payment method using the card Element
        const {token, error} = await stripe.createToken(cardElement);

        if (error) {
            alert('Error: ' + error.message);
        } else {
            // Send the token to the server for payment processing
            const paymentData = {
                amount: 100, // Amount in dollars
                token: token,
                buyerId: 1,  // Buyer ID from your application
                sellerId: 2, // Seller ID
                itemId: 3,   // Item ID
            };

            const response = await fetch('/assignment4/payment/create', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(paymentData),
            });

            const result = await response.json();
            if (result.message === 'Payment successful') {
                alert('Payment successful!');
            } else {
                alert('Payment failed');
            }
        }
    });
</script>
</body>
</html>
